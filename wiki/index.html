<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nikipedia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Shippori+Mincho:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Shippori Mincho', serif;
            background-color: #f8f9fa; /* Wikipedia's body background */
        }
        #main-container {
            border: 1px solid #a2a9b1;
            background-color: #ffffff;
        }
        #left-sidebar {
            border-right: 1px solid #a2a9b1;
        }
        #content-header ul li {
            border: 1px solid #a2a9b1;
            border-bottom: none;
            background-color: #f8f9fa;
        }
        #content-header ul li.active {
            background-color: #ffffff;
            border-bottom: 1px solid #ffffff;
        }
        .infobox {
            border: 1px solid #a2a9b1;
            background-color: #f8f9fa;
        }
        .infobox th, .infobox td {
            border-top: 1px solid #a2a9b1;
        }
        h1, h2, h3 {
            border-bottom: 1px solid #a2a9b1;
            padding-bottom: 0.3em;
        }
        .clearfix::after {
            content: "";
            clear: both;
            display: table;
        }
    </style>
</head>
<body class="p-0 md:p-4">

    <div class="flex max-w-screen-2xl mx-auto">
        <!-- Left Sidebar -->
        <aside id="left-sidebar" class="w-48 bg-white p-4 hidden md:block">
            <div class="flex items-center justify-center mb-6">
                <a href="?page=main">
                    <img src="icon.png" alt="Nikipedia Logo" width="135" height="135">
                </a>
            </div>
        </aside>

        <!-- Main Content Wrapper -->
        <div id="main-container" class="flex-1">
            <header class="flex justify-end p-2 border-b border-gray-300 h-[53px]">
                <!-- Search bar removed -->
            </header>

            <div id="content-header" class="px-4">
                 <ul class="flex -mb-px">
                    <li class="active -ml-px"><a href="#" class="inline-block py-2 px-4">記事</a></li>
                    <li><a href="#" class="inline-block py-2 px-4 text-blue-600">ノート</a></li>
                </ul>
            </div>
            
            <main id="main-content-area" class="p-6 md:p-8 border-t border-gray-300">
                <!-- Content will be inserted here by JS -->
            </main>
        </div>
    </div>

    <script>
        let wikiData = {};

        function parseWikiContent(contentSections) {
            if (!contentSections) return '';

            return contentSections.map(section => {
                let sectionHtml = `<h2 class="text-2xl font-bold mt-8 mb-4">${section.heading}</h2>`;
                
                if(section.paragraphs) {
                    sectionHtml += section.paragraphs.map(p_obj => {
                        const text = p_obj.text || '';
                        let imageHtml = '';

                        if (p_obj.image) {
                            imageHtml = `
                                <figure class="float-right ml-4 mb-2 w-64 border border-gray-300 p-1 bg-white text-sm">
                                    <img src="${p_obj.image.src}" alt="${p_obj.image.alt}" class="w-full">
                                    ${p_obj.image.caption ? `<figcaption class="text-xs text-center p-1 mt-1">${p_obj.image.caption}</figcaption>` : ''}
                                </figure>
                            `;
                        }

                        const processFormatting = (t) => t.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                        let textHtml;
                        if (text.startsWith('### ')) {
                            textHtml = `<h3 class="text-xl font-bold mt-4 mb-2">${processFormatting(text.substring(4))}</h3>`;
                        } else {
                            textHtml = `<p class="leading-relaxed">${processFormatting(text)}</p>`;
                        }
                        
                        return `<div class="clearfix">${imageHtml}${textHtml}</div>`;
                    }).join('');
                }

                return sectionHtml;
            }).join('');
        }

        function renderPage(page) {
            const mainContentContainer = document.getElementById('main-content-area');
            if (!page) {
                mainContentContainer.innerHTML = '<h1 class="text-4xl font-bold">ページが見つかりません</h1><p>指定されたページは存在しません。</p>';
                return;
            }
            
            let infoboxHtml = '';
            if (page.infobox) {
                const rows = Object.entries(page.infobox).map(([key, value]) => `
                    <tr>
                        <th class="p-2 text-left bg-gray-200 w-1/3 align-top">${key}</th>
                        <td class="p-2 text-left">${value}</td>
                    </tr>
                `).join('');
                infoboxHtml = `
                    <table class="infobox float-right w-full md:w-80 ml-6 mb-4 text-sm">
                        <tbody>
                            <tr><th colspan="2" class="p-2 text-center text-lg bg-gray-300">${page.title}</th></tr>
                            ${rows}
                        </tbody>
                    </table>
                `;
            }

            const contentHtml = parseWikiContent(page.content);

            mainContentContainer.innerHTML = `
                <article>
                    <h1 class="text-4xl font-bold mb-6">${page.title}</h1>
                    ${infoboxHtml}
                    ${contentHtml}
                </article>
            `;
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            fetch('./wiki_entries.json')
                .then(response => {
                    if (!response.ok) throw new Error('Network response was not ok');
                    return response.json();
                })
                .then(data => {
                    wikiData = data;
                    const { pages } = data;

                    const urlParams = new URLSearchParams(window.location.search);
                    let pageId = urlParams.get('page');

                    if (!pageId || !pages[pageId]) {
                        pageId = 'main';
                    }

                    renderPage(pages[pageId]);
                })
                .catch(error => {
                    console.error('データの読み込みに失敗しました:', error);
                    document.getElementById('main-content-area').innerHTML = '<p>記事を読み込めませんでした。</p>';
                });
        });
    </script>

</body>
</html>

